<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Call Simulator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    #messages { border: 1px solid #ccc; padding: 1em; height: 200px; overflow-y: auto; margin-bottom: 1em; }
    #settings { margin-bottom: 1em; }
    .ai { color: blue; }
    .user { color: green; }
    button { margin-right: 1em; padding: 0.5em 1em; }
    #micBtn.active { background-color: #ff3333; color: white; }
    #speakerBtn.active { background-color: #ff3333; color: white; }
    #sendBtn { background-color: #4CAF50; color: white; }
    #sendBtn:disabled, #startBtn:disabled, #stopBtn:disabled { background-color: #cccccc; }
  </style>
</head>
<body>
  <h1>ðŸ§  AI Call Simulator</h1>
  
  <div id="settings">
    <label>
      <input type="checkbox" id="autoSendCheckbox" checked>
      Enable Auto-Send on Silence
    </label><br>
    <label>
      Silence Timeout (seconds):
      <input type="number" id="timeoutSeconds" value="60" min="2" max="120">
    </label>
  </div>

  <div id="messages"></div>
  <button id="startBtn">Start Simulation</button>
  <button id="stopBtn" disabled>Stop Simulation</button>
  <button id="sendBtn" disabled>Send</button>
  <button id="micBtn" disabled>Microphone: Off</button>
  <button id="speakerBtn" disabled>Speaker: Off</button>

  <script>
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const sendBtn = document.getElementById("sendBtn");
    const micBtn = document.getElementById("micBtn");
    const speakerBtn = document.getElementById("speakerBtn");
    const autoSendCheckbox = document.getElementById("autoSendCheckbox");
    const timeoutSecondsInput = document.getElementById("timeoutSeconds");
    const messagesDiv = document.getElementById("messages");

    let recognition, autoSendTimer, collectedTranscript = "";
    let autoSendEnabled = true;
    let autoSendDelay = 60000; // 60 seconds
    let isSimulationActive = false;

    function appendMessage(who, text) {
      const msg = document.createElement("div");
      msg.className = who;
      msg.innerHTML = DOMPurify.sanitize(who.toUpperCase() + ": " + text);
      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function speak(text, callback) {
      speakerBtn.classList.add("active");
