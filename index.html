<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Speech PWA</title>
<link rel="manifest" href="manifest.json" />
<style>
  body { font-family: Arial, sans-serif; padding: 1em; }
  button { font-size: 1.2em; padding: 0.5em 1em; }
  #result { margin-top: 1em; white-space: pre-wrap; }
</style>
</head>
<body>
<h1>Speak & Ask AI</h1>
<button id="startBtn">ðŸŽ¤ Start Speaking</button>
<div id="result"></div>

<script>
const startBtn = document.getElementById('startBtn')
const resultDiv = document.getElementById('result')

let recognition
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition()
} else if ('SpeechRecognition' in window) {
  recognition = new SpeechRecognition()
} else {
  alert('Speech Recognition not supported in this browser.')
}

if (recognition) {
  recognition.lang = 'en-US'
  recognition.interimResults = false
  recognition.maxAlternatives = 1

  recognition.onresult = async (event) => {
    const speechText = event.results[0][0].transcript
    resultDiv.textContent = `You said: "${speechText}"\n\nWaiting for AI response...`

    const body = {
      contents: [
        { parts: [{ text: speechText }] }
      ]
    }

    try {
      const res = await fetch('https://workers-playground-sweet-truth-533a.amrassal91.workers.dev/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      })
      const data = await res.json()

      // Adjust depending on actual API response structure:
      const aiReply = data.candidates?.[0]?.content || JSON.stringify(data)
      resultDiv.textContent = `You said: "${speechText}"\n\nAI says:\n${aiReply}`
    } catch (err) {
      resultDiv.textContent = `Error fetching AI response: ${err.message}`
    }
  }

  recognition.onerror = (event) => {
    resultDiv.textContent = `Speech recognition error: ${event.error}`
  }

  startBtn.onclick = () => {
    resultDiv.textContent = ''
    recognition.start()
  }
}
</script>
</body>
</html>
